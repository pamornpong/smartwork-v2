<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>SMARTWORK – รายการผลงานทั้งหมด</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      body {
        font-family: "TH Sarabun New", "Sarabun", sans-serif;
        background: #f0f2f5;
        margin: 0;
        padding: 15px;
      }
      h2 {
        text-align: center;
        font-size: 30px;
        margin-top: 5px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 16px;
        margin-top: 20px;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        transition: 0.2s;
      }
      .card:hover {
        transform: scale(1.02);
      }
      .thumb {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
      }
      .title {
        font-size: 21px;
        font-weight: 600;
        margin-top: 10px;
      }
      .meta {
        font-size: 16px;
        color: #444;
        margin-top: 3px;
      }

      /* Modal */
      .modal-bg {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        padding: 20px;
      }
      .modal-box {
        background: #fff;
        border-radius: 12px;
        max-width: 900px;
        width: 100%;
        padding: 20px;
        max-height: 90%;
        overflow-y: auto;
      }
      .gallery img {
        width: 140px;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        margin-right: 8px;
        cursor: pointer;
      }
      .closeBtn {
        background: #d33;
        color: #fff;
        padding: 8px 20px;
        border: none;
        border-radius: 8px;
        float: right;
        cursor: pointer;
        font-size: 18px;
      }
    </style>
  </head>

  <body>
    <h2>รายการผลงานทั้งหมด (SMARTWORK)</h2>

    <div id="grid" class="grid"></div>

    <!-- MODAL -->
    <div id="modal" class="modal-bg">
      <div class="modal-box">
        <button class="closeBtn" onclick="closeModal()">ปิด</button>

        <h3 id="m_title"></h3>
        <p id="m_indicator"></p>
        <p id="m_date"></p>
        <p id="m_detail"></p>
        <p id="m_url"></p>

        <div id="m_gallery" class="gallery"></div>
      </div>
    </div>

    <script>
      // ===== API ของพี่เจษ =====
     const API_URL = "https://script.google.com/macros/s/AKfycby9nRIEiKen91ekZSf_U9G2svYB9SARqcQP4neyR2K-M3SI9gh7XDEvfE37N5V1MnO1JA/exec";

      // โหลดข้อมูลทั้งหมดจาก GAS
      async function loadData() {
        try {
          const res = await fetch(API_URL);
          const data = await res.json();
          renderCards(data);
        } catch (err) {
          Swal.fire("ผิดพลาด", "โหลดข้อมูลไม่สำเร็จ", "error");
        }
      }

      // แสดงการ์ดผลงาน
      function renderCards(list) {
        const grid = document.getElementById("grid");
        grid.innerHTML = "";

        if (!list || !list.length) {
          grid.innerHTML =
            "<p style='text-align:center;font-size:20px;'>ยังไม่มีข้อมูล</p>";
          return;
        }

        list.forEach((item) => {
          const img =
            item.pics && item.pics.length
              ? item.pics[0]
              : "https://via.placeholder.com/350x200?text=No+Image";

          const card = document.createElement("div");
          card.className = "card";
          card.onclick = () => openModal(item);

          card.innerHTML = `
            <img src="${img}" class="thumb">
            <div class="title">${item.title || "-"}</div>
            <div class="meta">วันที่: ${item.workDate || "-"}</div>
            <div class="meta">ตัวชี้วัด: ${item.indicator || "-"}</div>
          `;
          grid.appendChild(card);
        });
      }

      // เปิด modal
      function openModal(item) {
        document.getElementById("modal").style.display = "flex";

        document.getElementById("m_title").textContent = item.title || "-";
        document.getElementById("m_indicator").textContent =
          "ตัวชี้วัด: " + (item.indicator || "-");
        document.getElementById("m_date").textContent =
          "วันที่ดำเนินงาน: " + (item.workDate || "-");
        document.getElementById("m_detail").textContent =
          "รายละเอียด: " + (item.detail || "-");

        const urlBox = document.getElementById("m_url");
        if (item.url) {
          urlBox.innerHTML = `ลิงก์ผลงาน: <a href="${item.url}" target="_blank">${item.url}</a>`;
        } else {
          urlBox.innerHTML = "";
        }

        const gal = document.getElementById("m_gallery");
        gal.innerHTML = "";
        (item.pics || []).forEach((p) => {
          const img = document.createElement("img");
          img.src = p;
          img.onclick = () => window.open(p, "_blank");
          gal.appendChild(img);
        });
      }

      function closeModal() {
        document.getElementById("modal").style.display = "none";
      }

      // โหลดข้อมูลเมื่อเข้าเว็บ
      loadData();
    </script>
  </body>
</html>
